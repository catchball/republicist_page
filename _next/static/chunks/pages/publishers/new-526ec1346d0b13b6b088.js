(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[939],{4303:function(e,r,n){"use strict";n.r(r);var t=n(5893),s=n(6265),a=n(809),i=n.n(a),c=n(2447),u=n(4121),l=n(7294),o=n(1163),h=n(5887),p=n(6829),d=n(6466),f=n(3427),b=n(1855),j=n(3026),v=n(2510),x=n(6146);function g(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function m(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?g(Object(n),!0).forEach((function(r){(0,s.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}r.default=function(){var e=(0,o.useRouter)(),r=(0,l.useContext)(x.w).setError,n=(0,l.useState)(""),s=n[0],a=n[1],g=(0,l.useState)(!1),w=g[0],O=g[1],y=(0,p.useLazyQuery)(d.r),P=(0,u.Z)(y,2),_=P[0],k=P[1],E=k.data,U=k.called,C=(0,l.useState)({name:"",baseUrl:"",crawlingRuleId:1}),R=C[0],Z=C[1],S=(0,l.useState)({processor:"lxml"}),I=S[0],N=S[1],D=(0,p.useMutation)(b.U),L=(0,u.Z)(D,1)[0],z=(0,p.useMutation)(f.bq),F=(0,u.Z)(z,1)[0],M=function(){var e=(0,c.Z)(i().mark((function e(){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new URL(s),_({variables:{baseUrl:r.hostname}});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,l.useEffect)((function(){if(U&&E)if(E&&(null===E||void 0===E?void 0:E.publishers.length)>0)r({message:"Duplicate URL"});else try{var e=new URL(s);O(!0),Z({baseUrl:e.hostname,name:e.hostname,crawlingRuleId:1})}catch(n){return}}),[E,U]);var Q=function(){var n=(0,c.Z)(i().mark((function n(){var t,s,a,c,u,l,o;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,L({variables:m({},R)});case 2:if(t=n.sent,s=t.data,!(a=t.errors)||!a[0]){n.next=9;break}return console.log(a),r({message:a[0].message}),n.abrupt("return");case 9:if(null===s||void 0===s||!s.createPublisher.publisher){n.next=18;break}return c=null===s||void 0===s?void 0:s.createPublisher.publisher.id,n.next=13,F({variables:m(m({},I),{},{publisherId:c})});case 13:u=n.sent,l=u.data,(o=u.errors)&&o[0]&&r({message:o[0].message}),l&&e.push("/publishers/".concat(c));case 18:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)("main",{children:(0,t.jsxs)(h.W2,{children:[(0,t.jsxs)(h.$0,{children:[(0,t.jsx)("h1",{children:"\u65b0\u898f\u767b\u9332"}),!w&&(0,t.jsxs)("div",{children:[(0,t.jsxs)(h.gN,{children:[(0,t.jsx)("label",{htmlFor:"url",children:"URL"}),(0,t.jsx)(h.II,{placeholder:"https://example.co/articles/001.html",id:"url",value:s,onChange:function(e){return a(e.target.value)}})]}),(0,t.jsx)("div",{children:(0,t.jsx)(h.zx,{disabled:!s,onClick:M,children:"\u4f5c\u6210"})})]}),w&&(0,t.jsxs)("div",{children:[(0,t.jsx)(h.RQ,{src:s,title:R.name}),(0,t.jsx)(v.Z,{publisher:R,onPublisherChange:function(e){return Z(m({},e))}}),(0,t.jsx)(j.Z,{scraping:m(m({},I),{},{testUrl:s}),onScrapingChange:function(e){return N(e)},scrapingId:0})]})]}),w&&(0,t.jsx)(h.$0,{children:(0,t.jsx)(h.EK,{children:(0,t.jsx)(h.zx,{onClick:Q,children:"\u767b\u9332"})})})]})})})}},8555:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/publishers/new",function(){return n(4303)}])}},function(e){e.O(0,[581,774,888,179],(function(){return r=8555,e(e.s=r);var r}));var r=e.O();_N_E=r}]);